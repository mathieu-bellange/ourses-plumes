<!doctype html>
<html lang="fr">
	<head>
		<script src="boot.js"></script>
	</head>
	<body>

		<!--Dev Testbar-->
		<div id="dev_testbar">
			<svg width="0" height="0" viewBox="0 0 48 48">
				<polygon points="48,28 48,40 24,48 0,40 0,28 24,36 "/>
				<polygon points="48,10 48,22 24,30 0,22 0,10 24,18 "/>
			</svg>
			<h4>Voir</h4>
			<label for="show_view">Visualisation</label>
			<input id="show_view" type="checkbox" name="show" value="faq_view" checked>
			<label for="show_edit">Édition</label>
			<input id="show_edit" type="checkbox" name="show" value="faq_edit" checked>
			<label for="css_debug">Masques CSS</label>
			<input id="css_debug" type="checkbox">
		</div>
		<script>
		// Live Events
		$("html").on("click", "[name='show']", function() {
			var f = $(this).val();
			$("#" + f).toggle();
		});
		$("html").on("click", "#css_debug", function() {
			$("section").toggleClass("css-debug")
		});
		// Initialization
		$(document).ready(function() {
			$("#css_debug").is(":checked") ? $("section").addClass("css-debug") : $("section").removeClass("css-debug");
			$("[name='show']").each(function() {
				var f = $(this).val();
				if ($(this).is(":checked")) {
					$("#" + f).show();
				} else {
					$("#" + f).hide();
				}
			});
		});
		</script>

		<div id="dev_container" class="frame">

			<h2 class="red">FAQ <small>.faq</small></h2>

			<!--View FAQ-->
			<div id="faq_view">

				<dl class="faq view">
					<!--
					<dt class="question icon-right small" tabindex="0">
						<span class="text">Mais...Pourquoi &laquo; Les Ourses &agrave; plumes &raquo; ???</span>
						<span class="icon-hide vis-tip"></span>
					</dt>
					<dd class="answer" style="display: none;">
						<p>Nous n'avons pas d'explication r&eacute;ellement rationnelle &agrave; cette question. Ce que nous pouvons vous dire, c'est que nous ne voulions pas d'un titre trop &quot;intello&quot;, mais quelque chose allant vers l'imaginaire et qui sonne bien, que l'on retient. Nous avons donc choisi un animal : une ourse. Son c&ocirc;t&eacute; &quot;forte&quot; nous plaisait. De l&agrave;, est parti un brainstorming intense (si si !) pour choisir un nom. Vous avez donc &eacute;chapp&eacute; &agrave; notamment : &quot;les grandes ourses&quot;, &quot;ourses rousses&quot;, &quot;les ourses tricotent&quot;, ou encore &quot;le prisme des ourses&quot;. &quot;Les Ourses &agrave; plumes&quot; l'a emport&eacute; pour la double signification des &quot;plumes&quot;, celles pour &eacute;crire, mais &eacute;galement celles qui servent &agrave; s'envoler. Un grain de fantaisie, mais aussi d'espoir, que le f&eacute;minisme d&eacute;colle dans notre soci&eacute;t&eacute; o&ugrave; il est toujours malheureusement aussi n&eacute;cessaire.</p>
					</dd>
					<dt class="question icon-right small" tabindex="0">
						<span class="text">Y a-t-il des crit&egrave;res pour &eacute;crire dans Les Ourses &agrave; plumes ?</span>
						<span class="icon-hide vis-tip"></span>
					</dt>
					<dd class="answer" style="display: none;">
						<p>Nous avons fait le choix que nos r&eacute;dactrices soient concern&eacute;es au premier chef par les oppressions qu'elles d&eacute;crivent. De m&ecirc;me qu&rsquo;il nous para&icirc;t important que les articles traitant d&rsquo;handicap ou du racisme soient &eacute;crits par des personnes en situation de handicap ou subissant le racisme, il nous semble primordial que cela soit les femmes (cis ou trans) et les hommes trans qui &eacute;crivent sur leur propre oppression.<br>Nous sommes toutefois pas compl&egrave;tement ferm&eacute;es &agrave; l&rsquo;id&eacute;e d&rsquo;avoir un jour des r&eacute;dacteurs- hommes cis f&eacute;ministes, mais cela restera des exceptions. Parce que nous consid&eacute;rons que les hommes cis ont d&eacute;j&agrave; &eacute;norm&eacute;ment d'espaces ailleurs pour s'exprimer, y compris sur le f&eacute;minisme.</p>
						<p>Nous parlons des Ourses, des r&eacute;dactrices au f&eacute;minin, m&ecirc;me si des hommes trans, et exceptionnellement cis, peuvent y participer, car le masculin est d&eacute;j&agrave; omnipr&eacute;sent et dominant dans le langage courant, alors m&ecirc;me que les femmes sont majoritaires (dans la population...et surtout chez les Ourses !).</p>
					</dd>
					<dt class="question icon-right small" tabindex="0">
						<span class="text">Comment peut-on soutenir votre site ? Peut-on y participer ?</span>
						<span class="icon-hide vis-tip"></span>
					</dt>
					<dd class="answer" style="display: none;">
						<p>Pour nous soutenir, il y a tout d&rsquo;abord des gestes gratuits, qui peuvent avoir beaucoup d&rsquo;impact : parler de nous autour de vous, relayez nos articles sur les r&eacute;seaux sociaux...Nous sommes aussi ouvertes &agrave; vos suggestions de sujets ou d&rsquo;&eacute;v&eacute;nements &agrave; rajouter dans notre agenda.</p>
						<p><strong>Nous cherchons encore des r&eacute;dactrices et des illustratrices (dessinatrices, photographes), b&eacute;n&eacute;voles,</strong> qui soient en accord avec notre ligne &eacute;ditoriale, n&rsquo;h&eacute;sitez donc pas &agrave; nous contacter si vous &ecirc;tes int&eacute;ress&eacute;e par le projet.</p>
						<p>Financi&egrave;rement, nous sommes toujours preneuses de dons, car la campagne de crowfunding sur Ulule ne permettra que de financer un an d&rsquo;h&eacute;bergement. Il nous reste &eacute;galement d&rsquo;autres frais de fonctionnement &agrave; prendre en compte, ainsi que peut-&ecirc;tre un investissement dans du mat&eacute;riel professionnel. Pour assurer la p&eacute;rennit&eacute; du site, un bouton Paypal devrait &ecirc;tre bient&ocirc;t mis en place, en attendant vous pouvez aussi nous envoyer un ch&egrave;que...</p>
					</dd>
					-->
				</dl>
			</div>

			<!--Edit FAQ-->
			<div id="faq_edit">
				<dl class="faq edit">
					<!--
					<dt class="question icon-right small" tabindex="0">
						<input required type="text" placeholder="Question" value="Mais...Pourquoi &laquo; Les Ourses &agrave; plumes &raquo; ???" disabled>
						<button class="button reject icon-remove tiny" title="Supprimer" data-delete="0"><span class="hide">Supprimer</span></button>
					</dt>
					<dd class="answer" style="display: none;">
						<textarea required placeholder="R&eacute;ponse" class="min">Nous n'avons pas d'explication r&eacute;ellement rationnelle &agrave; cette question. Ce que nous pouvons vous dire, c'est que nous ne voulions pas d'un titre trop &quot;intello&quot;, mais quelque chose allant vers l'imaginaire et qui sonne bien, que l'on retient. Nous avons donc choisi un animal : une ourse. Son c&ocirc;t&eacute; &quot;forte&quot; nous plaisait. De l&agrave;, est parti un brainstorming intense (si si !) pour choisir un nom. Vous avez donc &eacute;chapp&eacute; &agrave; notamment : &quot;les grandes ourses&quot;, &quot;ourses rousses&quot;, &quot;les ourses tricotent&quot;, ou encore &quot;le prisme des ourses&quot;. &quot;Les Ourses &agrave; plumes&quot; l'a emport&eacute; pour la double signification des &quot;plumes&quot;, celles pour &eacute;crire, mais &eacute;galement celles qui servent &agrave; s'envoler. Un grain de fantaisie, mais aussi d'espoir, que le f&eacute;minisme d&eacute;colle dans notre soci&eacute;t&eacute; o&ugrave; il est toujours malheureusement aussi n&eacute;cessaire.</textarea>
					</dd>
					<dt class="question icon-right small" tabindex="0">
						<input required type="text" placeholder="Question" value="Y a-t-il des crit&egrave;res pour &eacute;crire dans Les Ourses &agrave; plumes ?" disabled>
						<button class="button reject icon-remove tiny" title="Supprimer" data-delete="0"><span class="hide">Supprimer</span></button>
					</dt>
					<dd class="answer" style="display: none;">
						<textarea required placeholder="R&eacute;ponse" class="min">Nous avons fait le choix que nos r&eacute;dactrices soient concern&eacute;es au premier chef par les oppressions qu'elles d&eacute;crivent. De m&ecirc;me qu&rsquo;il nous para&icirc;t important que les articles traitant d&rsquo;handicap ou du racisme soient &eacute;crits par des personnes en situation de handicap ou subissant le racisme, il nous semble primordial que cela soit les femmes (cis ou trans) et les hommes trans qui &eacute;crivent sur leur propre oppression.<br>Nous sommes toutefois pas compl&egrave;tement ferm&eacute;es &agrave; l&rsquo;id&eacute;e d&rsquo;avoir un jour des r&eacute;dacteurs- hommes cis f&eacute;ministes, mais cela restera des exceptions. Parce que nous consid&eacute;rons que les hommes cis ont d&eacute;j&agrave; &eacute;norm&eacute;ment d'espaces ailleurs pour s'exprimer, y compris sur le f&eacute;minisme.

	Nous parlons des Ourses, des r&eacute;dactrices au f&eacute;minin, m&ecirc;me si des hommes trans, et exceptionnellement cis, peuvent y participer, car le masculin est d&eacute;j&agrave; omnipr&eacute;sent et dominant dans le langage courant, alors m&ecirc;me que les femmes sont majoritaires (dans la population...et surtout chez les Ourses !).</textarea>
					</dd>
					<dt class="question icon-right small" tabindex="0">
						<input required type="text" placeholder="Question" disabled>
						<button class="button reject icon-remove tiny" title="Supprimer" data-delete="0"><span class="hide">Supprimer</span></button>
					</dt>
					<dd class="answer" style="display: none;">
						<textarea required placeholder="R&eacute;ponse" class="min"></textarea>
					</dd>
					-->
				</dl>
				<p class="text-center">
					<button class="button action" data-create>Nouvelle FAQ</button>
					<button class="button accept" data-valid>Valider les FAQ</button>
				</p>
			</div>

			<script>
				/* ------------------------------------------------------------ */
				/* # TEST only : Document initialization */
				/* ------------------------------------------------------------ */
				$(document).ready(function() {
					process_faq(); // insert faq into DOM
				});
				/* ------------------------------------------------------------ */
				/* # TEST only : Variables */
				/* ------------------------------------------------------------ */
				var faq_data = [
					{"question" : "Mais...Pourquoi « Les Ourses à plumes » ???", "answer" : "<p>Nous n'avons pas d'explication réellement rationnelle à cette question. Ce que nous pouvons vous dire, c'est que nous ne voulions pas d'un titre trop \"intello\", mais quelque chose allant vers l'imaginaire et qui sonne bien, que l'on retient. Nous avons donc choisi un animal : une ourse. Son côté \"forte\" nous plaisait. De là, est parti un brainstorming intense (si si !) pour choisir un nom. Vous avez donc échappé à notamment : \"les grandes ourses\", \"ourses rousses\", \"les ourses tricotent\", ou encore \"le prisme des ourses\". \"Les Ourses à plumes\" l'a emporté pour la double signification des \"plumes\", celles pour écrire, mais également celles qui servent à s'envoler. Un grain de fantaisie, mais aussi d'espoir, que le féminisme décolle dans notre société où il est toujours malheureusement aussi nécessaire.</p>"},
					{"question" : "Y a-t-il des critères pour écrire dans Les Ourses à plumes ?", "answer" : "<p>Nous avons fait le choix que nos rédactrices soient concernées au premier chef par les oppressions qu'elles décrivent. De même qu’il nous paraît important que les articles traitant d’handicap ou du racisme soient écrits par des personnes en situation de handicap ou subissant le racisme, il nous semble primordial que cela soit les femmes (cis ou trans) et les hommes trans qui écrivent sur leur propre oppression.</p> <p>Nous sommes toutefois pas complètement fermées à l’idée d’avoir un jour des rédacteurs-hommes cis féministes, mais cela restera des exceptions. Parce que nous considérons que les hommes cis ont déjà énormément d'espaces ailleurs pour s'exprimer, y compris sur le féminisme.</p><p>Nous parlons des Ourses, des rédactrices au féminin, même si des hommes trans, et exceptionnellement cis, peuvent y participer, car le masculin est déjà omniprésent et dominant dans le langage courant, alors même que les femmes sont majoritaires (dans la population...et surtout chez les Ourses !).</p>"},
					{"question" : "Que signifie le terme “intersectionnalité” ?", "answer" : "<p>C’est un terme forgé en 1991 par Kimberlé Crenshaw, une chercheuse féministe américaine qui travaillait sur les violences subies par les femmes racisées des classes populaires. L’intersectionnalité, c’est celle des différentes oppressions (sexisme, racisme, homophobie, de classe, mais aussi handiphobie, transphobie...). Ce terme permet de souligner que chacune se trouve à l’intersection de plusieurs systèmes d’oppression, et qu’il faut tenir compte dans nos analyses de ces différentes oppressions. Ainsi, on ne peut pas analyser de la même façon la situation d’une femme racisée et celle d’une femme non-racisée, ou encore celle d’une femme hétéro et celle d’une femme lesbienne. Sans parler des femmes racisées et lesbiennes !</p><p>Le concept d’intersectionnalité permet d’éviter de nier les divergences de situations et donc de vécus, tout en les replaçant dans une perspective de systèmes et non de situations individuelles.</p>"}
				];
				var faq_view_template = "<dt class='question icon-right small' tabindex='0'><span class='text'>{{= question }}</span><span class='icon-hide vis-tip'></span></dt><dd class='answer' style='display: none;'>{{= answer }}</dd>";
				var faq_edit_template = "<dt class='question icon-right small' tabindex='0'><input type='text' placeholder='Question' value='{{= question }}' required disabled><button class='button reject icon-remove tiny' title='Supprimer' data-delete><span class='hide'>Supprimer</span></button></dt><dd class='answer' style='display: none;'><textarea placeholder='R&eacute;ponse' class='min' required>{{= answer }}</textarea></dd>";
				/* ------------------------------------------------------------ */

				// Functions
				function get_faq(template, decode) {
					var decode = decode || false, s = "";
					for (n in faq_data) {
						var q = template;
						for (k in faq_data[n]) {
							var reg = new RegExp("\\{\\{=\\s" + k + "\\s\\}\\}", "gi");
							q = q.replace(reg, (decode ? decode_html(faq_data[n][k], true) : faq_data[n][k])); // decode html
						} s += q;
					} return s;
				}

				function process_faq() {
					////////////////////////////////////////////////////////////////
					// TODO
					////////////////////////////////////////////////////////////////
					// AJAX : get faq key-pairs values
					// - on fail, display error
					// - on success, proceed insertion
					////////////////////////////////////////////////////////////////
					$(".faq.view").append(get_faq(faq_view_template)) // insert template filled with params into DOM
					$(".faq.edit").append(get_faq(faq_edit_template, true)) // insert template filled with params into DOM
					$("textarea").add_confirmation_bar(); // add confirmation to textarea
					$(".faq").svg_icons()// reload svg icons from parent
				}

				function create_faq() {
					////////////////////////////////////////////////////////////////
					// TODO
					////////////////////////////////////////////////////////////////
					// AJAX : get faq new id
					// - on fail, display error
					// - on success, process faq template with param new id
					////////////////////////////////////////////////////////////////
					$(".faq.edit").append(faq_edit_template.replace(/\{\{[^}]*\}\}/gi, "")); // append faq item template
					$("textarea").add_confirmation_bar(); // add confirmation to textarea
					$(".faq.edit").svg_icons()// reload svg icons from parent
				}

				function confirm_delete(obj) {
					var modal_options = {
						"text" : $msg.confirm_delete.faq,
						"class" : "panel callout radius",
						"on_confirm" : function() {
							delete_faq(obj)
						}
					};
					obj.create_confirmation_modal(modal_options);
				}

				function delete_faq(obj) {
					var id = obj.data("delete");
					////////////////////////////////////////////////////////////////
					// TODO
					////////////////////////////////////////////////////////////////
					// AJAX : delete faq matching id
					// - on fail, display error
					// - on success, display delete confirmation
					////////////////////////////////////////////////////////////////
					obj.parent(".question").next(".answer").detach();
					obj.parent(".question").detach();
					$("#dev_testbar").create_alert_box($msg.faq_deleted, id, {"class" : "warning", "icon" : "info", "timeout" : $time.duration.alert_short}); // display form invalid alert
				}

				function check_faq() {
					var q = $(".faq.edit .question > input");
					var a = $(".faq.edit .answer > textarea");
					var c = function(s) { // custom condition
						return (s == "zizi" || s == "bite" ? false : true); // not 'zizi' and not 'bite'
					}
					// 1. Check fields validity
					q.check_validity(c, "Les zizis et les bites ne sont pas tol&eacute;r&eacute;s&nbsp;!"); // check all question fields with custom condition and custom message
					a.check_validity(); // check all answer fields with default condition (not empty)
					// 2. Check form validity
					if (q.add(a).is_valid()) { // if all fields are valid
						var data = [];
						$(".faq.edit .question").each(function() {
							data.push({"question" : encode_html($(this).find("input").val()), "answer" : encode_html($(this).next(".answer").find("textarea").val(), true)});
						});
						submit_faq(data); // send data to db
					} else { // any field is invalid
						$(".faq.edit .answer > textarea").each(function() {
							if ($(this).data("valid") == false) {
								faq_ui.open($(this).parent(), -1); // force open tab withtout scrolling
							}
						});
						$("#dev_testbar").create_alert_box($msg.form_invalid, null, {"timeout" : $time.duration.alert_long}); // display form invalid alert
					}
				}

				function submit_faq(data) {
					////////////////////////////////////////////////////////////////
					// TODO : send faq fields to db
					////////////////////////////////////////////////////////////////
					// AJAX : send faq to db
					// - on fail, display error
					// - on success, display submit confirmation
					////////////////////////////////////////////////////////////////
					alert(JSON.stringify(data)); // TO REMOVE
					////////////////////////////////////////////////////////////////
					$("#dev_testbar").create_alert_box($msg.form_valid, null, {"class" : "success", "icon" : "info", "timeout" : $time.duration.alert});
				}

				// Document Live Events
				$(document)
					// Visual Effects
					.on("focus mouseenter", "[data-delete]", function() {$(this).parent().addClass("warning")})
					.on("blur mouseleave", "[data-delete]", function() {$(this).parent().removeClass("warning")})
					// Data Handling
					.on("click", "[data-create]", function() {create_faq()})
					.on("click", "[data-delete]", function() {confirm_delete($(this))})
					.on("click", "[data-valid]", function() {check_faq()})
					.on("focus", "[required]", function() {$(this).set_validity()}) // set field validity to undefined on focus (could also be on change or on blur)
					// User Interface
					.on("click keydown", ".faq.edit .question > input, [data-delete]", function(e) {e.stopImmediatePropagation()});
			</script>

		</div>

		<script>
			$(document).ready(function() {faq_ui.init()});
		</script>

		<script>
			$build.container = false;
			load();
		</script>
	</body>
</html>

<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8">
		<script src="boot"></script>
		<script src="js/ckeditor/ckeditor.js"></script><!--TEMP-->
		<script src="js/ckeditor/adapters/jquery.js"></script><!--TEMP-->
		<script>
			// TEMP : Set route CKEditor configuration file route
			var loc = location.href.split("/");
			loc.splice(loc.length - 1, 1);
			$cke_config_path = isFileProtocol() ? loc.join("/") + "/" + $js_root : $js_root;
		</script>
	</head>
	<body>

		<h2 class="red">&Eacute;diteur <small>#article_editor</small></h2>

		<!--Dev Test Editor Toolbar-->
		<style>
			#dev_test_editor_toolbar {padding: .5rem 1.5rem;}
			#dev_test_editor_toolbar > h4 {display: inline-block; margin-right: .5rem; color: darkgray;}
			#dev_test_editor_toolbar > label {margin: 0 0 0 .5rem;}
			#dev_test_editor_toolbar > input[type="checkbox"] {margin: 0; vertical-align: middle;}
			#dev_test_editor_toolbar > input[type="button"] {margin-left: 1rem;}
		</style>
		<div id="dev_test_editor_toolbar" class="panel">
			<h4 class="text-medium">Show</h4>
			<label for="show_publishing">Publishing</label>
			<input id="show_publishing" type="checkbox" name="show" value="publishing">
			<label for="show_indexing">Indexing</label>
			<input id="show_indexing" type="checkbox" name="show" value="indexing" checked>
			<label for="show_classic_editor">Classic Editor</label>
			<input id="show_classic_editor" type="checkbox" name="show" value="classic_editor_fieldset">
			<label for="show_inline_editor">Inline Editor</label>
			<input id="show_inline_editor" type="checkbox" name="show" value="inline_editor_fieldset">
			<label for="show_rubrics_switcher">Rubrics Switcher</label>
			<input id="show_rubrics_switcher" type="checkbox" name="show" value="rubrics_switcher">
			<input id="cke_plugins" class="button tiny" type="button" value="CKEditor plugins">
		</div>
		<script>
		// Events
		$("html").on("click", "[name='show']", function() {
			var f = $(this).val();
			$("#" + f).toggle();
		});
		$("html").on("click", "#cke_plugins", function() {
			var cke_plugins = CKEDITOR.config.plugins.split(",");
			var str = new String;
			for (i in cke_plugins) {
				str += cke_plugins[i] + "\n";
			}
			alert(str);
		});
		// Init
		$(document).ready(function() {
			$("[name='show']").each(function() {
				var f = $(this).val();
				if ($(this).is(":checked")) {
					$("#" + f).show();
				} else {
					$("#" + f).hide();
				}
			});
		});
		</script>

		<form method="get" accept-charset="utf-8" autocomplete="off" novalidate>

			<fieldset id="publishing" class="important">
				<legend>Publication</legend>

				<!--Title-->
				<label for="title">Titre de l&rsquo;article</label>
				<input id="title" type="text" placeholder="Le titre de l&rsquo;article (p. ex. &ldquo;L&rsquo;&eacute;galit&eacute; entre les sexes, une question plus que jamais d&rsquo;actualit&eacute;&ldquo;)">

				<!--Date-->
				<label for="date">Date de publication pr&eacute;visionnelle</label>
				<div class="row collapse">
					<div class="column small-4">
						<input id="date" type="text" placeholder="JJ/MM/AAAA">
					</div>
					<div class="column small-8">
						<span id="date_literal" class="postfix">&hellip;</span>
					</div>
				</div>

				<!--Author-->
				<label for="author">R&eacute;dactrice</label>
				<input id="author" type="text" disabled>

				<!--Status-->
				<label for="status">Statut</label>
				<select id="status" disabled>
					<option selected>Brouillon</option>
					<option>En attente de validation</option>
					<option>En ligne</option>
				</select>

			</fieldset>

			<fieldset id="indexing">
				<legend>Ind&eacute;xation</legend>

				<!--Rubric-->
				<div class="row collapse">
					<div class="column small-12">
						<label for="rubric">Rubrique <small class="red">*</small></label>

							<select id="rubric">
								<option disabled selected>&hellip;</option>
								<option class="test" data-color="orange">Luttes</option>
								<option data-color="magenta">Nos corps, nous-m&ecirc;mes</option>
								<option data-color="red">Intersectionnalit&eacute;</option>
								<option data-color="blue">International</option>
								<option data-color="cyan">&Eacute;ducation & Culture</option>
								<option data-color="yellow">Id&eacute;es</option>
							</select>

					</div>
				</div>

				<!--Category-->
				<div class="row collapse">
					<div class="column small-12">
						<label for="category">Cat&eacute;gorie <small class="red">*</small></label>
						<select id="category">
							<option disabled selected>&hellip;</option>
							<option>Br&egrave;ve</option>
							<option>Reportage</option>
							<option>Dossier</option>
							<option>Spotlight</option>
							<option>Interview</option>
							<option>Tribune</option>
							<option>Revue du web</option>
						</select>
					</div>
				</div>

				<!--Tags-->
				<div class="row collapse">
					<div class="column">
						<label for="tag">Tags</label>
					</div>

					<style>
						/* Named Components */
						#tag {}
						#tag_add {margin-bottom: 0;}
						/* Autocomplete */
						.autocomplete {
							font-size: 87.5%;
							background-color: rgba(255, 0, 0, .5);
							background-color: transparent;
							transition: box-shadow .5s;
						}
						.autocomplete ul {
							margin: 0 0 1rem;
							list-style: none;
							background-color: rgba(0, 255, 0, .5);
							background-color: white;
							border-width: 0 .125rem;
							border-style: solid;
							border-color: silver;
						}
						.autocomplete ul > li {
							padding: 0 .5rem;
							line-height: 200%;
						}
						.autocomplete ul > li.selected {
							color: HighlightText;
							background-color: Highlight;
							font-weight: bold;
						}
						.autocomplete ul > li.selected mark {
							color: white;
							background-color: #d52;
						}
						.autocomplete ul > li.suggested-fetch {
							font-weight: bold;
						}
						.autocomplete ul > li.suggested-fetch:after {
							content: "Suggéré";
							float: right;
							color: darkgray;
							font-size: 75%;
							font-weight: bold;
						}
						.autocomplete ul > li.suggested-fetch.selected:after {
							color: rgba(255, 255, 255, .5);
						}
						input:focus + button + .error + .autocomplete {
							-webkit-box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .5);
								 -moz-box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .5);
											box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .5);
						}
						input:focus + button + .error + .autocomplete > ul {
							border-color: darkgray;
						}
						.css-debug .autocomplete ul > li:nth-child(odd) {
							background-color: rgba(0, 255, 0, .5);
						}
						.css-debug .autocomplete ul > li:nth-child(even) {
							background-color: rgba(0, 0, 255, .5);
						}
					</style>

					<div class="column">
						<input id="tag" class="validation-icon" style="display: inline-block; height: 2.25rem; width: 16rem; border-width: .125rem;" type="text" placeholder="Une &eacute;tiquette au choix (32 carac.)" maxlength="32"><button id="tag_add" type="button" href="javascript:void(0)" class=" icon-add small" style=""></button>
						<small id="tag_error" class="hide error" style="top: 0; width: 16rem;">Ce tag est déjà pris !</small>
						<div class="autocomplete hide" style="position: relative; width: 16rem; z-index: 2;">
							<ul>
								<li>Amphibien</li>
								<li>Amphipode</li>
								<li>Amphithéatre</li>
								<li>Amphore</li>
								<li>Amphotère</li>
								<li>Amplificateur</li>
								<li>Ampoule</li>
								<li>Amputation</li>
								<li>Jeu ViDeo</li>
								<li>Jeux-vidéos</li>
								<li>Jeux  vidéos</li>
								<li class="suggested-fetch" >Jeux vidéos</li>
								<li>JEUX VIDEOS</li>
								<li>Jeux_vidéos</li>
							</ul>
						</div>
					</div>

					<div class="column" style="margin-bottom: 1rem;"><span style="font-size: 87.5%; color: dimgray;">Try it now ! Type <code>amp</code> or <code>jeu</code> in the input.</span></div>

				</div><!--row-->

				<script>
					// vars
					var min_i = 3;
					var max_displayed_items = 6;
					var i = min_i;
					// events
					$("#tag").bind({
						focus : function() {
							$("#tag").css("margin-bottom", "0");
							$(".autocomplete").removeClass("hide");
						},
						blur : function() {
							$(this).val($(this).val().trim()); // remove white spaces
							$(".autocomplete").addClass("hide");
							$("#tag").css("margin-bottom", "");
						},
						keydown : function(e) {
							if (e.which == 13 || e.which == 27) { // Enter or Escape
								$(this).blur();
							}
							if (e.which == 33 || e.which == 34 || e.which == 38 || e.which == 40) { // PageUp, PageDown, End, Home or Up or Down
								e.preventDefault();
								index = 0;
								var index = $(".autocomplete ul > li.selected").index();
								if (index == -1) {
									$(".autocomplete ul > li").not(".hide").first().addClass("selected");
								}
								if (e.which == 33) { // PageUp
									$(".autocomplete ul > li").removeClass("selected");
									$(".autocomplete ul > li").not(".hide").first().addClass("selected");
								}
								if (e.which == 34) { // PageDown
									$(".autocomplete ul > li").removeClass("selected");
									$(".autocomplete ul > li").not(".hide").last().addClass("selected");
								}
								if (e.which == 38 && index - 1 >= 0) { // Up
									$(".autocomplete ul > li:eq(" + index + ")").prevAll("li:not('.hide')").first().addClass("selected");
									if ($(".autocomplete ul > li:eq(" + index + ")").prevAll("li:not('.hide')").first().hasClass("selected")) {
										$(".autocomplete ul > li:eq(" + index + ")").removeClass("selected");
									}
								}
								if (e.which == 40) { // Down
									$(".autocomplete ul > li:eq(" + index + ")").nextAll("li:not('.hide')").first().addClass("selected");
									if ($(".autocomplete ul > li:eq(" + index + ")").nextAll("li:not('.hide')").first().hasClass("selected")) {
										$(".autocomplete ul > li:eq(" + index + ")").removeClass("selected");
									}
								}
								var s = $(".autocomplete ul > li.selected").text();
								$(this).val(s);
								// scroll to selected item
								if ($(".autocomplete ul > li").hasClass("selected")) {
									if ($(".autocomplete ul > li").not(".hide").first().hasClass("selected")) {
										scrollTo($("#tag"), 250, $("#tag").outerHeight());
									} else if ($(".autocomplete ul > li").not(".hide").last().hasClass("selected")) {
										scrollTo($(".autocomplete ul > li.selected"), 250, $("#tag").outerHeight());
									} else {
										scrollTo($(".autocomplete ul > li.selected"), 0);
									}
								}
							}
						},
						keyup : function(e) {
							if ((e.which >= 48 && e.which <= 57) || (e.which >= 64 && e.which <= 90) || (e.which >= 96 && e.which <= 105) || e.which == 32 || e.which == 8 || e.which == 46) { // From 0 to 9 or from A to Z or from Numpad 0 to Numpad 9 or Space or Backspace or Del
								$(".autocomplete ul > li").removeClass("selected"); // unselect all
								if (e.which == 8 || e.which == 46) { // Backspace or Del
									if (i > 0) {
										i -= 1;
									}
								}
								if ($(this).val().length >= min_i) {
									var k = 0;
									var m = $(this).val();
									i = $(this).val().length;
									$(".autocomplete ul > li").each(function() {
										var r = $(this).text().slice(0, i);
										if (r.toLowerCase() == m.toLowerCase() && k < max_displayed_items) {
											var str = $(this).text();
											var html = "<mark>" + str.slice(0, i) + "</mark>" + str.substr(i, str.length);
											$(this).html(html);
											$(this).removeClass("hide");
											k++;
										} else {
											$(this).addClass("hide");
										}
									});
									// scroll
									if ($(".autocomplete").offset().top + $(".autocomplete").height() > $(window).height() + $(document).scrollTop()) {
										scrollTo($(".autocomplete ul > li:visible").last(), 500, $("#tag").outerHeight());
									} else {
										scrollTo($(".autocomplete").parent(), 500, $("#tag").outerHeight());
									}
								} else {
									$(".autocomplete ul > li").each(function() {
										$(this).addClass("hide"); // hide all autocompletion items
									});
								}
							}
						},
					});
					$(".autocomplete ul > li").not("hide").bind({
						mouseenter : function() {
							$(this).siblings().removeClass("selected");
							$(this).addClass("selected");
							$("#tag").val($(this).text());
						},
						mouseleave : function() {
							$(this).removeClass("selected");
						}
					});
					$(document).ready(function() {
						$(".autocomplete ul > li").each(function() {
							$(this).addClass("hide"); // hide all autocompletion items
						});
					});
				</script>

				<!--
				<dl id="tags" class="tags inline-list clearfix">
					<dt><span class="icon-tag small" title="Tags"><span class="hide">Tags</span></span></dt>
					<dd class="hide"><span id="tag_rubric" class="label radius">&hellip;</span></dd>
					<dd class="hide"><span id="tag_category" class="label radius inverse">&hellip;</span></dd>
				</dl>
				-->

				<!--Summary-->
				<div>
					<label for="summary">R&eacute;sum&eacute;</label>
					<textarea id="summary" class="min" maxlength="255" placeholder="Une br&egrave;ve description de l&rsquo;article pour le r&eacute;f&eacute;rencement (255 caract&egrave;res maximum)"></textarea>
				</div>

			</fieldset>

			<!--Rubrics Switcher-->
			<style>
				#rubrics_switcher {text-align: center;}
				#rubrics_switcher > ul,
				#rubrics_switcher > ul > li,
				#rubrics_switcher > ul > li > a {margin-bottom: 0;}
			</style>
			<div id="rubrics_switcher">
				<ul class="inline-list">
					<li><a id="cke_rub_intersec" href="javascript:void(0)" class="button small secondary">Intersectionnalit&eacute;</a></li>
					<li><a id="cke_rub_struggles" href="javascript:void(0)" class="button small secondary">Luttes</a></li>
					<li><a id="cke_rub_ideas" href="javascript:void(0)" class="button small secondary">Id&eacute;es</a></li>
					<li><a id="cke_rub_educult" href="javascript:void(0)" class="button small secondary">&Eacute;ducation &amp; Culture</a></li>
					<li><a id="cke_rub_internat" href="javascript:void(0)" class="button small secondary">International</a></li>
					<li><a id="cke_rub_ourbody" href="javascript:void(0)" class="button small secondary">Nos corps, nous-m&ecirc;mes</a></li>
				</ul>
			</div>
			<script>
				$("[id^='cke_rub_']").click(function() {
					$(this).parent().siblings().children().removeClass("active"); // Remove all active classes for rubrics buttons
					$("#inline_editor").removeClass(); // Remove all classes for inline editor
					$("#inline_editor").addClass("article"); // Reset article class for inline editor
					if ($(this).hasClass("active")) {
						$(this).removeClass("active");
					} else {
						$(this).addClass("active");
						var cls = $(this).attr("id").substr(8); // Retrieve rubric class from button id
						$("#inline_editor").addClass(cls); // Add new rubric class to inline editor
					}
					CKEDITOR.instances["classic_editor"].destroy(); // Destroy classic editor instance
					CKEDITOR.replace("classic_editor", { // Reinitialize classic editor instance with rubric class
						customConfig : $cke_config_path + "editor_settings.js",
						contentsCss : "css/loap-main.css",
						bodyClass : "article " + cls,
						toolbarLocation : "bottom"
					});
				});
			</script>

			<!--Classic CKEditor-->
			<fieldset id="classic_editor_fieldset">
				<legend>R&eacute;daction</legend>
				<label for="classic_editor">Corps de texte <span class="text-silver">classic</span></label>
				<textarea id="classic_editor">
					<h4>Un inter&dash;titre tout &agrave; fait ordinaire</h4>
					<div class="callout">Une accroche qui reprend le texte en-dessous pour attirer l&rsquo;attention du lectorat</div>
					<p>Un paragraphe plut&ocirc;t court avec un <a href="#">lien hypertexte</a> &agrave; l&rsquo;int&eacute;rieur.</p>
					<p><img alt="Ours" src="http://www.cinephilme.com/public/ours/l-ours-332883.jpg" style="height: 200px; margin: 10px;" />Un paragraphe avec une image &agrave; l&rsquo;int&eacute;rieur.</p>
				</textarea>
			</fieldset>

			<!--Inline CKEditor-->
			<fieldset id="inline_editor_fieldset" class="invisible">
				<legend>R&eacute;daction</legend>
				<style>
					.article {
						padding: .5rem;
						border: 1px solid transparent;
						background-color: white;
					}
					.article:hover {
						cursor: pointer;
						border-style: dashed;
						border-color: darkgray;
						background-color: whitesmoke;
					}
					.article:focus {
						cursor: text;
						border-style: solid;
						border-color: darkgray;
						background-color: white;
						box-shadow: 0 0 .125rem .125rem rgba(0, 0, 0, .25);
						transition: box-shadow .75s;
					}
				</style>
				<label for="inline_editor" style="margin-top: 2rem;">Corps de texte <span class="text-silver">inline</span></label>
				<div id="inline_editor" class="article" contenteditable="true">
					<h4>Un inter&dash;titre tout &agrave; fait ordinaire</h4>
					<div class="callout">Une accroche qui reprend le texte en-dessous pour attirer l&rsquo;attention du lectorat</div>
					<p>Un paragraphe plut&ocirc;t court avec un <a href="#">lien hypertexte</a> &agrave; l&rsquo;int&eacute;rieur.</p>
					<p><img alt="Ours" src="http://www.cinephilme.com/public/ours/l-ours-332883.jpg" style="height: 200px; margin: 10px;" />Un paragraphe avec une image &agrave; l&rsquo;int&eacute;rieur.</p>
				</div>
			</fieldset>

			<!--Validation Buttons-->
			<div class="text-center" style="margin-top: 1rem;">
				<input class="button tip-top" type="button" value="Enregistrer" title="Mettre l&rsquo;article de c&ocirc;t&eacute; pour le modifier plus tard" data-tooltip data-options="disable_for_touch:true">
				<input class="button alert tip-top" type="button" value="Valider" title="Soumettre l&rsquo;article &agrave; la r&eacute;daction pour publication" data-tooltip data-options="disable_for_touch:true">
			</div>

		</form>

		<script>
			$build_container = false;
			load();
		</script>
		<script>
			loap.update()
			$(document).ready(function(){
				$("textarea").autosize({append: ""}); // Apply autosize plugin to all <textarea> of the page
				$("textarea").validation_bar(); // Apply validation_bar plugin to all <textarea> of the page
			});
		</script>
		<script>
			// Initialize Foundation plugins
			$(document).foundation();
			// Initialize classic CKEditor with custom config
			CKEDITOR.replace("classic_editor", {
				customConfig : $cke_config_path + "editor_settings.js",
				contentsCss : "css/loap-main.css",
				bodyClass : "article",
				toolbarLocation : "bottom"
			});
			// Initialize inline CKEditor with custom config
			CKEDITOR.disableAutoInline = true;
			CKEDITOR.inline("inline_editor", {
				customConfig : $cke_config_path + "editor_settings.js",
				contentsCss : "css/loap-main.css"
			});
		</script>
	</body>
</html>

<!doctype html>
<html lang="fr">
	<head>
		<script src="boot.js"></script>
	</head>
	<body>

		<h2 class="red">Formulaires <small>&lt;form&gt;</small></h2>

		<!--Dev Testbar-->
		<div id="dev_testbar" class="panel">
			<svg width="0" height="0" viewBox="0 0 48 48">
				<polygon points="27,35.59 40,22.59 40,31.91 24,47.91 8,31.91 8,22.59 21,35.59 21,0 27,0 "/>
			</svg>
			<h4>Voir</h4>
			<label for="show_fieldsets">Jeux de champs</label>
			<input id="show_fieldsets" type="checkbox" name="show" value="fieldsets">
			<label for="show_selects">Listes de choix</label>
			<input id="show_selects" type="checkbox" name="show" value="selects">
			<label for="show_textareas">Zones de texte</label>
			<input id="show_textareas" type="checkbox" name="show" value="textareas">
			<label for="show_encode">Encodage</label>
			<input id="show_encode" type="checkbox" name="show" value="encoding" checked>
		</div>
		<script>
		// Events
		$("html").on("click", "[name='show']", function() {
			var f = $(this).val();
			$("#" + f).toggle();
		});
		// Init
		$(document).ready(function() {
			$("[name='show']").each(function() {
				var f = $(this).val();
				if ($(this).is(":checked")) {
					$("#" + f).show();
				} else {
					$("#" + f).hide();
				}
			});
		});
		</script>

		<!--Fieldsets-->
		<section id="fieldsets">
			<h3>Jeux de champ <small>&lt;fieldset&gt;</small></h3>

			<form method="get" accept-charset="utf-8" autocomplete="off" novalidate>

				<h4 class="subheader">L&eacute;gende seule</h4>
				<fieldset>
					<legend>myLegend</legend>
				</fieldset>

				<h4 class="subheader">Pas de l&eacute;gende</h4>
				<fieldset>
					<input type="text" placeholder="myPlaceHolder">
					<textarea placeholder="myPlaceHolder"></textarea>
					<input type="button" value="Valider" class="button right">
				</fieldset>

				<h4 class="subheader">Important <small>.important</small></h4>
				<fieldset class="important">
					<legend>myLegend</legend>
					<input type="text" placeholder="myPlaceHolder">
					<textarea placeholder="myPlaceHolder"></textarea>
					<input type="button" value="Valider" class="button right">
				</fieldset>

				<h4 class="subheader">Transparent <small>.transparent</small></h4>
				<fieldset class="transparent">
					<legend>myLegend</legend>
					<input type="text" placeholder="myPlaceHolder">
					<textarea placeholder="myPlaceHolder"></textarea>
					<input type="button" value="Valider" class="button right">
				</fieldset>

			</form>
		</section>

		<!--Selects-->
		<section id="selects">
			<h3>Liste de choix <small>&lt;select&gt;</small></h3>

			<form method="get" accept-charset="utf-8" autocomplete="off" novalidate>
				<fieldset>

					<!--Standard Select-->
					<label for="standard_select">Standard Select</label>
					<select id="standard_select">
						<option>Option</option>
						<option selected>Selected</option>
						<option disabled>Disabled</option>
						<option style="color: red;">Stylized</option>
					</select>

					<!--Options Select-->
					<label >Options Select <span class="text-small text-silver">.options-select</span></label>
					<div class="options-select" tabindex="0">
						<span class="select"><span class="text-silver">Please select an option</span></span>
						<ul class="options hide">
							<li>Option</li>
							<li class="selected">Selected</li>
							<li class="disabled">Disabled</li>
							<li style="color: red;">Stylized</li>
						</ul>
					</div>
					<p class="text-small"><strong>Advantages</strong>&thinsp;: full control against behaviour (script based), same display on all browsers (CSS based)<br><strong>Inconvenients</strong>&thinsp;: not focusable element (i.e. &lt;div&gt;), unusable on plain HTML display</p>

				</fieldset>
			</form>
		</section>
		<script>
			$(document).ready(function() {
				$(".options-select").options_select();
			});
		</script>

		<!--Textareas-->
		<section id="textareas">
			<h3>Zones de texte <small>&lt;textarea&gt;</small></h3>
			<form method="get" accept-charset="utf-8" autocomplete="off" novalidate>
				<fieldset>
					<legend>myLegend</legend>

					<label for="input_default">Default text input</label>
					<input id="input_default" type="text" placeholder="myPlaceHolder">

					<label for="textarea_default">Default text area (4 lines)</label>
					<textarea id="textarea_default" placeholder="myPlaceHolder"></textarea>

					<label for="textarea_min">Minimal text area (1 line) <span class="text-silver">class="min"</span></label>
					<textarea id="textarea_min" class="min" placeholder="myPlaceHolder"></textarea>

					<label for="textarea_tiny">Tiny text area (2 lines) <span class="text-silver">class="tiny"</span></label>
					<textarea id="textarea_tiny" class="tiny" placeholder="myPlaceHolder"></textarea>

					<label for="textarea_small">Small text area (4 lines) <span class="text-silver">class="small"</span></label>
					<textarea id="textarea_small" class="small" placeholder="myPlaceHolder"></textarea>

					<label for="textarea_medium">Medium text area (8 lines) <span class="text-silver">class="medium"</span></label>
					<textarea id="textarea_medium" class="medium" placeholder="myPlaceHolder"></textarea>

					<label for="textarea_large">Large text area (12 lines) <span class="text-silver">class="large"</span></label>
					<textarea id="textarea_large" class="large" placeholder="myPlaceHolder"></textarea>

					<input type="button" value="Valider" class="button right">

				</fieldset>
			</form>
		</section>

		<!--Encoding-->
		<section id="encoding">

			<!--Input-->
			<label for="textarea">Textarea</label>
			<textarea id="textarea" class="min" style="margin-bottom: 1rem;" maxlength="-1" placeholder="Votre texte ici">L'apostrophe ? -- Un "'*signe diacritique...*'" - pour lequel la '^critique^' "n'a point d'égal" !</textarea>

			<!--Output-->
			<div style="width: 100%; font-size: 0;">
				<div style="display: inline-block; width: 50%; padding-right: .5rem; vertical-align: top; font-size: 1rem;">
					<label for="output">Output</label>
					<div id="output" class="panel">&hellip;</div>
				</div>
				<div style="display: inline-block; width: 50%; padding-left: .5rem; vertical-align: top; font-size: 1rem;">
					<label for="input">Input</label>
					<div id="input" class="panel callout">&hellip;</div>
				</div>
			</div>

			<!--Buttons-->
			<button id="encode" class="primary">Encoder</button>
			<button id="decode" class="secondary">D&eacute;coder</button>
			<button id="clear" class="alert">Effacer</button>

		</section>
		<script>

			$(document).ready(function() {

				$("#textarea").add_confirmation_bar();

				// ===========================================================
				// # HTML Entities
				// ===========================================================

				// Variables
				var illegal_chars = {
					"&" : "&amp;",
					"<" : "&lt;",
					">" : "&gt;"
				}
				var format_chars_enc = {
					"\\*(\.*)\\*" : "<strong>$1</strong>",
					"\\^(\.*)\\^" : "<em>$1</em>"
				}
				var format_chars_dec = {
					"<em>(\.*)<\\/em>" : "^$1^",
					"<strong>(\.*)<\\/strong>" : "*$1*"
				}
				var special_chars = {
					'"\'(\\S)' : "&laquo;&#8239;$1",
					'(\\S)\'"' : "$1&#8239;&raquo;",
					"(\\S)'(\\S)" : "$1&rsquo;$2",
					"'(\\S)" : "&lsquo;$1",
					"(\\S)'" : "$1&rsquo;",
					'"(\\S)' : "&ldquo;$1",
					'(\\S)"' : "$1&rdquo;",
					"\\s!" : "&nbsp;!",
					"\\s\\?" : "&nbsp;?",
					"\\.\\.\\." : "&hellip;",
					"--" : "&mdash;",
					"-" : "&ndash;"
				}
				var diacritical_chars = {
					"à" : "&agrave;",
					"À" : "&Agrave;",
					"â" : "&acirc;",
					"Â" : "&Acirc;",
					"ä" : "&auml;",
					"Ä" : "&Auml;",
					"ç" : "&ccedil;",
					"Ç" : "&Ccedil;",
					"é" : "&eacute;",
					"É" : "&Eacute;",
					"è" : "&egrave;",
					"É" : "&Eacute;",
					"ê" : "&ecirc;",
					"Ê" : "&Ecirc;",
					"ë" : "&euml;",
					"Ë" : "&Euml;",
					"î" : "&icirc;",
					"Î" : "&Icirc;",
					"ï" : "&iuml;",
					"Ï" : "&Iuml;",
					"ô" : "&ocirc;",
					"Ô" : "&Ocirc;",
					"ö" : "&ouml;",
					"Ö" : "&Ouml;",
					"ù" : "&ugrave;",
					"Ù" : "&Ugrave;",
					"û" : "&ucirc;",
					"Û" : "&Ucirc;",
					"ü" : "&uuml;",
					"Ü" : "&Uuml;",
					"ae" : "&aelig;",
					"Ae" : "&AElig;",
					"oe" : "&oelig;",
					"Oe" : "&OElig;"
				}
				// Functions
				function gsub(str, obj, v_k, del) {
					var v_k = v_k || false, del = del || false;
					for (key in obj) {
						var reg = new RegExp((v_k ? obj[key] : key), "g");
						str = str.replace(reg, (del ? "" : (v_k ? key : obj[key])));
					} return str;
				}
				function gsup(str, obj) {
					return gsub(str, obj, true);
				}
				function gdel(str, obj) {
					return gsub(str, obj, null, true);
				}

				function encode_illegal(str) {return gsub(str, illegal_chars)}
				function decode_illegal(str) {return gsup(str, illegal_chars)}
				function remove_illegal(str) {return gdel(str, illegal_chars)}

				function encode_format(str) {return gsub(str, format_chars_enc)}
				function decode_format(str) {return gsub(str, format_chars_dec)}
				function remove_format(str) {return gdel(str, format_chars_enc)}

				function encode_special(str) {return gsub(str, special_chars)}
				function decode_special(str) {return gsup(str, special_chars)}
				function remove_special(str) {return gdel(str, special_chars)}

				function encode_diacritical(str) {return gsub(str, diacritical_chars)}
				function decode_diacritical(str) {return gsup(str, diacritical_chars)}
				function remove_diacritical(str) {return gdel(str, diacritical_chars)}

				function encode_html(str) {
					str = encode_illegal(str);
					str = encode_format(str);
					str = encode_special(str);
					str = encode_diacritical(str);
					return str;
				}
				function decode_html(str) {
					str = decode_diacritical(str);
					//str = decode_special(str); // WARNING ! Special chars are never decoded ! ()
					str = decode_illegal(str);
					str = decode_format(str);
					str = str.replace(/&nbsp;/g, " "); // No-Break Space Fix
					return str;
				}
				// L'apostrophe ? -- Un "'*signe diacritique...*'" - pour lequel la '^critique^' "n'a point d'égal" !
				// "'*Auri Sacra Fames !*'" -- ^Virgile^

				// ===========================================================
				// # Line Ends
				// ===========================================================

				// Functions
				function encode_line_ends(str) {
					return (str + "\n\n")
						.replace(/(.+)\n/g, "$1<br>")
						.replace(/(.+)<br>\n/g, "<p>$1</p>")
						.trim()
						.replace(/\n/g, "<br>");
				}
				function decode_line_ends(str) {
					return str
						.replace(/<p>/g, "")
						.replace(/<br>/g, "\n")
						.replace(/<\/p>/g, "\n\n")
						.trim();
				}
				// Events
				$("#textarea").on("keydown", function(e) {
					if (e.which == 13 && !e.shiftKey && !e.ctrlKey) { // Enter AND NOT Shift
						var str = $(this).val();
						var pos = $(this).get(0).selectionStart; // get cursor position (n.b. HTML 5 feature)
						$(this).val(str.trunc(pos) + "\n" + str.cut(pos)); // insert line end at cursor position
						$(this).get(0).setSelectionRange(pos + 1, pos + 1); // reset cursor position
					}
					if (e.which == 13 && e.ctrlKey) { // Enter + Ctrl = validation
						$("#encode").click(); // NOTE : overriden event from validation_bar
					}
				});
				$("#textarea").on("focusout", function() {
					if ($(".confirmation-bar [data-confirm]").length > 0 && $(".confirmation-bar [data-confirm]").is(":hover")) {
						$("#encode").click(); // NOTE : overriden event from validation_bar
					}
				});
				$("#encode").click(function() {
					var s = $("#textarea").val().trim(), t = encode_html(s), p = encode_line_ends(t);
					$("#textarea").val(s);
					$("#textarea").trigger("autosize.resize") // force autosize
					$("#output").html(p.length > 0 ? p : "&nbsp;");
					////////////////////////////////////////////////////////////
					// alert(p); // TODO -- this is what should be saved in db
					////////////////////////////////////////////////////////////
				});
				$("#decode").click(function() {
					var t = decode_line_ends($("#output").html()), s = decode_html(t);
					$("#input").html(encode_html(t));
					$("#textarea").val(s == "&nbsp;" ? "" : s);
					$("#textarea").trigger("autosize.resize") // force autosize
				});
				$("#clear").click(function() {
					$("#input").html("&nbsp;");
					$("#textarea").val("");
					$("#textarea").trigger("autosize.resize") // force autosize
				});

			});

		</script>

		<script>
			$build.container = false;
			load();
		</script>
	</body>
</html>

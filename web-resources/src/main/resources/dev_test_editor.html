<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8">
		<script src="boot"></script>
		<script src="js/ckeditor/ckeditor.js"></script><!--TEMP-->
		<script src="js/ckeditor/adapters/jquery.js"></script><!--TEMP-->
		<script>
			// TEMP : Set route CKEditor configuration file route
			var loc = location.href.split("/");
			loc.splice(loc.length - 1, 1);
			$cke_config_path = isFileProtocol() ? loc.join("/") + "/" + $js_root : $js_root;
		</script>
	</head>
	<body>

		<h2 class="red">&Eacute;diteur <small>.article.edit</small></h2>

		<!--Dev Testbar-->
		<div id="dev_testbar" class="panel">
			<svg width="0" height="0" viewBox="0 0 48 48">
				<polygon points="27,35.59 40,22.59 40,31.91 24,47.91 8,31.91 8,22.59 21,35.59 21,0 27,0 "/>
			</svg>
			<h4>Voir</h4>
			<label for="show_publishing">Publishing</label>
			<input id="show_publishing" type="checkbox" name="show" value="publishing" checked>
			<label for="show_classic_editor">Classic Editor</label>
			<input id="show_classic_editor" type="checkbox" name="show" value="classic_editor_fieldset">
			<label for="show_inline_editor">Inline Editor</label>
			<input id="show_inline_editor" type="checkbox" name="show" value="inline_editor_fieldset" checked>
			<label for="show_rubrics_switcher">Rubrics Switcher</label>
			<input id="show_rubrics_switcher" type="checkbox" name="show" value="rubrics_switcher">
			<input id="cke_plugins" class="button tiny secondary" type="button" value="CKEditor plugins">
		</div>
		<script>
		// Events
		$("html").on("click", "[name='show']", function() {
			var f = $(this).val();
			$("#" + f).toggle();
		});
		$("html").on("click", "#cke_plugins", function() {
			var cke_plugins = CKEDITOR.config.plugins.split(",");
			var str = new String;
			for (i in cke_plugins) {
				str += cke_plugins[i] + "\n";
			}
			alert(str);
		});
		// Init
		$(document).ready(function() {
			$("[name='show']").each(function() {
				var f = $(this).val();
				if ($(this).is(":checked")) {
					$("#" + f).show();
				} else {
					$("#" + f).hide();
				}
			});
		});
		</script>

		<form class="article edit" method="get" accept-charset="utf-8" autocomplete="off" novalidate>

			<fieldset id="publishing" class="transparent">
				<legend class="hide">Publication</legend>

				<!--Title-->
				<label for="title" class="hide">Titre de l&rsquo;article</label>
				<input id="title" class="title" type="text" placeholder="Le titre de l&rsquo;article">
				<small class="error hide">Ce titre est d&eacute;j&agrave; pris</small>

				<!--Author-->
				<h4 class="author"><span class="icon-author" title="Auteure"><span class="text">Nadejda</span></span></h4>

				<!--Date-->
				<!--
				<time datetime="2014-01-01" class="date icon-date small">1<sup>er</sup> janvier 2014</span>
				-->

				<!--Status-->
				<!--
				<label for="status">Statut</label>
				<select id="status" disabled>
					<option selected>Brouillon</option>
					<option>En attente de validation</option>
					<option>En ligne</option>
				</select>
				-->

				<!--Summary-->
				<label for="summary" class="hide">R&eacute;sum&eacute; <small class="red">*</small></label>
				<textarea id="summary" class="summary validation min" maxlength="1000" placeholder="Une br&egrave;ve description de l&rsquo;article pour le r&eacute;f&eacute;rencement (1000 caract&egrave;res maximum)"></textarea>
				<small class="error hide">La saisie du r&eacute;sum&eacute; est obligatoire</small>
				<script>
				$("html").on("keydown", "#summary", function(event) {
					if (event.ctrlKey && event.which == 13) { // Ctrl + Enter
					toggle_tags();
					$("#rubric").focus();
					}
				});
				</script>

				<!--Tags List-->
				<dl class="tags inline-list clearfix" tabindex="0">
					<dt class="icon-tag small"><strong class="text hide">Tags</strong></dt>
					<!--
					<dd><a href="javascript:void(0)" rel="tag" class="label radius">Rubrique</a></dd>
					<dd><a href="javascript:void(0)" rel="tag" class="label radius inverse">Cat&eacute;gorie</a></dd>
					-->
				</dl>
				<script>

					// Display indexation panel (i.e. tags editing)
					function toggle_tags() {
						$(".tags").blur();
						if ($(".tags").data("preventClick") !== "true" && $(".tags").data("preventToggle") !== "true") {
							$(".tags").toggleClass("active");
							if ($("#indexing").is(":visible")) {
								$js_fx ? $("#indexing").slideUp(250) : $("#indexing").hide();
							} else {
								$(".tags").data("preventToggle", "true");
								if ($js_fx) {
									$("#indexing").slideDown(250, function() {
										scrollTo($("#indexing"), 250, $("#tags").outerHeight() + 16);
										$(".tags").removeData("preventToggle");
									});
								} else {
									$("#indexing").show();
									scrollTo($("#indexing"), 0, $("#tags").outerHeight() + 16);
									$(".tags").removeData("preventToggle");
								}
							}
						}
					}

					// Tags list prevent click from child element
					$(".tags dd").on("mouseenter", function() {
						$(".tags").data("preventClick", "true");
					});
					$(".tags dd").on("mouseleave", function() {
						$(".tags").removeData("preventClick");
					});

					// Tags list toggle indexation display
					$(".tags").on("click", function() {
						toggle_tags();
					});
					$(".tags").on("keypress", function(e) {
						if (e.which === 13) {
							toggle_tags();
						}
					});

				</script>

			</fieldset>

			<fieldset id="indexing" style="display: none;">
				<legend class="hide">Ind&eacute;xation</legend>

				<!--Rubric-->
				<label for="rubric">Rubrique <small class="red">*</small></label>
				<div id="rubric" class="options-select validation" tabindex="0">
					<span class="select"><span class="text-silver">Veuillez indiquer la rubrique de l&rsquo;article</span></span>
					<ul class="options hide">
						<li><span class="icon-struggles small" style="margin-right: .25rem;"></span>Luttes</li>
						<li><span class="icon-ourbody small" style="margin-right: .25rem;"></span>Nos corps, nous-m&ecirc;mes</li>
						<li><span class="icon-intersec small" style="margin-right: .25rem;"></span>Intersectionnalit&eacute;</li>
						<li><span class="icon-internat small" style="margin-right: .25rem;"></span>International</li>
						<li><span class="icon-educult small" style="margin-right: .25rem;"></span>&Eacute;ducation & Culture</li>
						<li><span class="icon-ideas small" style="margin-right: .25rem;"></span>Id&eacute;es</li>
					</ul>
				</div>
				<small class="error hide">La saisie de la rubrique est obligatoire</small>

				<!--Category-->
				<label for="category">Cat&eacute;gorie <small class="red">*</small></label>
				<div id="category" class="options-select validation" tabindex="0">
					<span class="select"><span class="text-silver">Veuillez choisir une une cat&eacute;gorie d&rsquo;article</span></span>
					<ul class="options hide">
						<li>Br&egrave;ve</li>
						<li>Reportage</li>
						<li>Dossier</li>
						<li>Spotlight</li>
						<li>Interview</li>
						<li>Tribune</li>
						<li>Revue du web</li>
					</ul>
				</div>
				<small class="error hide">La saisie de la cat&eacute;gorie est obligatoire</small>

				<style>
					/* TEMP : Tag styles */
					#tag {display: inline-block; width: 18rem; height: 2.25rem; border-width: .125rem;}
					#tag_add {margin-bottom: 0;}
					#tag_add + small.error {position: relative; top: 0; width: 18rem; z-index: 2;}
					#tag_add + small.error + .autocomplete {position: relative; width: 18rem; z-index: 1;}
					#tag.wrong {border-color: #c33;}
					#tag.wrong:focus + #tag_add + small.error {
						-webkit-box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .5);
							 -moz-box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .5);
										box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .5);
					}
				</style>

				<!--Tags-->
				<label for="tag">Tags</label>
				<div>
					<input id="tag" class="validation" type="text" maxlength="32" placeholder="Une &eacute;tiquette au choix (32 carac.)"><button id="tag_add" type="button" class=" icon-add small"></button>
					<small class="hide error">Ce tag est déjà pris !</small>
					<div class="autocomplete hide">
						<ul>
							<!--
							<li>Amphibien</li>
							<li>Amphipode</li>
							<li>Amphithéatre</li>
							<li>Amphore</li>
							<li>Amphotère</li>
							<li>Amplificateur</li>
							<li>Ampoule</li>
							<li>Amputation</li>
							<li>Jeu ViDeo</li>
							<li>Jeux-vidéos</li>
							<li>Jeux  vidéos</li>
							<li class="suggested-fetch" >Jeux vidéos</li>
							<li>JEUX VIDEOS</li>
							<li>Jeux_vidéos</li>
							-->
						</ul>
					</div>
				</div>
				<div style="margin-bottom: 1rem;"><span style="font-size: 87.5%; color: dimgray;">Try it now ! Type <code>amp</code>, <code>ban</code> or <code>jeu</code> in the input.</span></div>

				<script>

					/* Tags automated reflow */
					$("#tag").keyup(function(e) {
						if ((e.which >= 48 && e.which <= 57) || (e.which >= 64 && e.which <= 90) || (e.which >= 96 && e.which <= 105) || e.which == 32 || e.which == 8 || e.which == 46) { // From 0 to 9 or from A to Z or from Numpad 0 to Numpad 9 or Space or Backspace or Del
							var str = $(this).val();
							if (str.length >= 3) {

								var x =["Amphibien", "Amphipode", "Amphithéatre", "Amphore", "Amphotère", "Amplificateur", "Ampoule", "Amputation", "Band Apart", "Bandage", "Bande", "Bandeau", "Banderole", "Bandit", "Jeu ViDeo", "Jeux-vidéos", "Jeux  vidéos", "Jeux vidéos", "JEUX VIDEOS", "Jeux_vidéos"];

								// query input value
								var list = new Array;
								switch (str.toLowerCase()) {
									case "amp" :
										list = ["1", "2", "3", "4", "5", "6", "7", "8"]
										break;
									case "ban" :
										list = ["9", "10", "11", "12", "13", "14"]
										break;
									case "jeu" :
										list = ["15", "16", "17", "18", "19", "20"]
										break;
								}

								// check if value alreay exists
								$(".autocomplete ul > li").each(function () {
									var k = list.indexOf($(this).attr("data-id"));
									if (k !== -1) {
										list.splice(k , 1)
									}
								});

								// reflow autocomplete with query result
								for (i in list) {
									$(".autocomplete ul").append("<li data-id='" + list[i] + "' class='hide'>" + x[list[i]] + "</li>");
								}

								// TODO : sort items

							}
						}
					});
				</script>

			</fieldset>

			<!--Rubrics Switcher-->
			<style>
				#rubrics_switcher {text-align: center;}
				#rubrics_switcher > ul,
				#rubrics_switcher > ul > li,
				#rubrics_switcher > ul > li > a {margin-bottom: 0;}
			</style>
			<div id="rubrics_switcher">
				<ul class="inline-list">
					<li><a id="cke_rub_intersec" href="javascript:void(0)" class="button small secondary">Intersectionnalit&eacute;</a></li>
					<li><a id="cke_rub_struggles" href="javascript:void(0)" class="button small secondary">Luttes</a></li>
					<li><a id="cke_rub_ideas" href="javascript:void(0)" class="button small secondary">Id&eacute;es</a></li>
					<li><a id="cke_rub_educult" href="javascript:void(0)" class="button small secondary">&Eacute;ducation &amp; Culture</a></li>
					<li><a id="cke_rub_internat" href="javascript:void(0)" class="button small secondary">International</a></li>
					<li><a id="cke_rub_ourbody" href="javascript:void(0)" class="button small secondary">Nos corps, nous-m&ecirc;mes</a></li>
				</ul>
			</div>
			<script>
				$("[id^='cke_rub_']").click(function() {
					$(this).parent().siblings().children().removeClass("active"); // Remove all active classes for rubrics buttons
					$("#inline_editor").removeClass(); // Remove all classes for inline editor
					$("#inline_editor").addClass("article"); // Reset article class for inline editor
					if ($(this).hasClass("active")) {
						$(this).removeClass("active");
					} else {
						$(this).addClass("active");
						var cls = $(this).attr("id").substr(8); // Retrieve rubric class from button id
						$("#inline_editor").addClass(cls); // Add new rubric class to inline editor
					}
					CKEDITOR.instances["classic_editor"].destroy(); // Destroy classic editor instance
					CKEDITOR.replace("classic_editor", { // Reinitialize classic editor instance with rubric class
						customConfig : $cke_config_path + "editor_settings.js",
						contentsCss : "css/loap-main.css",
						bodyClass : "article " + cls,
						toolbarLocation : "bottom"
					});
				});
			</script>

			<!--Classic CKEditor-->
			<fieldset id="classic_editor_fieldset">
				<legend>R&eacute;daction</legend>
				<label for="classic_editor">Corps de texte <span class="text-silver">classic</span></label>
				<textarea id="classic_editor">
					<p class="placeholder">Le corps de l'article</p>
					<h4>Un inter&dash;titre tout &agrave; fait ordinaire</h4>
					<div class="callout">Une accroche qui reprend le texte en-dessous pour attirer l&rsquo;attention du lectorat</div>
					<p>Un paragraphe plut&ocirc;t court avec un <a href="#">lien hypertexte</a> &agrave; l&rsquo;int&eacute;rieur.</p>
					<p><img alt="Ours" src="http://www.cinephilme.com/public/ours/l-ours-332883.jpg" style="height: 200px; margin: 10px;" />Un paragraphe avec une image &agrave; l&rsquo;int&eacute;rieur.</p>
					<!--
					<p><iframe allowfullscreen="" frameborder="0" width="640" height="360" src="//www.youtube.com/embed/iUs2Wzupf1c?rel=0"></iframe></p>
					-->
				</textarea>
			</fieldset>

			<!--Inline CKEditor-->
			<fieldset id="inline_editor_fieldset" class="transparent">
				<legend class="hide">R&eacute;daction</legend>
				<label for="inline_editor" class="hide">Corps de texte <span class="text-silver">inline</span></label>
				<div id="inline_editor" class="inline-editor" contenteditable="true" data-placeholder>
					<p class="placeholder">Le corps de l'article</p>
					<!--
					<h4>Un inter&dash;titre tout &agrave; fait ordinaire</h4>
					<div class="callout">Une accroche qui reprend le texte en-dessous pour attirer l&rsquo;attention du lectorat</div>
					<p>Un paragraphe plut&ocirc;t court avec un <a href="#">lien hypertexte</a> &agrave; l&rsquo;int&eacute;rieur.</p>
					<p><img alt="Ours" src="http://www.cinephilme.com/public/ours/l-ours-332883.jpg" style="height: 200px; margin: 10px;" />Un paragraphe avec une image &agrave; l&rsquo;int&eacute;rieur.</p>
					<p><iframe allowfullscreen="" frameborder="0" width="640" height="360" src="//www.youtube.com/embed/iUs2Wzupf1c?rel=0"></iframe></p>
					-->
				</div>
			</fieldset>

			<!--Validation Buttons-->
			<div class="text-center" style="margin-top: 1rem;">
				<input class="button secondary tip-top" type="button" value="Lecture seule" title="Visualiser l&rsquo;article sans les fonctionnalit&eacute;s d&rsquo;&eacute;dition" data-tooltip data-options="disable_for_touch:true">
				<input class="button success tip-top" type="button" value="Enregistrer" title="Mettre l&rsquo;article de c&ocirc;t&eacute; pour le modifier plus tard" data-tooltip data-options="disable_for_touch:true">
				<input class="button alert tip-top" type="button" value="Valider" title="Soumettre l&rsquo;article &agrave; la r&eacute;daction pour publication" data-tooltip data-options="disable_for_touch:true">
			</div>

		</form>

		<script>
			$build_container = false;
			load();
		</script>
		<script>
			loap.update()
			$(document).ready(function(){
				$("textarea").autosize({append: ""}); // Apply autosize plugin to all <textarea> of the page
				$("textarea").add_confirmation_bar(); // Apply add_confirmation_bar plugin to all <textarea> of the page
				$(".options-select").options_select(); // Apply options_select plugin to all .options-select of the page
				$("#tag").autocomplete(); // Apply autocomplete plugin to #tag input
			});
		</script>
		<script>
			// Initialize Foundation plugins
			$(document).foundation();
			// Initialize classic CKEditor with custom config
			CKEDITOR.replace("classic_editor", {
				customConfig : $cke_config_path + "editor_settings.js",
				contentsCss : "css/loap-main.css",
				bodyClass : "article",
				toolbarLocation : "bottom"
			});
			// Initialize inline CKEditor with custom config
			CKEDITOR.disableAutoInline = true;
			CKEDITOR.inline("inline_editor", {
				customConfig : $cke_config_path + "editor_settings.js",
				extraAllowedContent : {"p" : {classes : "placeholder", styles : "color"}},
				contentsCss : "css/loap-main.css",
			});
		</script>
	</body>
</html>

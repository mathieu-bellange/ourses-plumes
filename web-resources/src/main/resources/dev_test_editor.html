<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8">
		<script src="boot"></script>
		<script src="js/ckeditor/ckeditor.js"></script><!--TEMP-->
		<script src="js/ckeditor/adapters/jquery.js"></script><!--TEMP-->
		<script>
			// TEMP : Set route CKEditor configuration file route
			var loc = location.href.split("/");
			loc.splice(loc.length - 1, 1);
			$cke_config_path = isFileProtocol() ? loc.join("/") + "/" + $js_root : $js_root;
		</script>
	</head>
	<body>

		<h2 class="red">&Eacute;diteur <small>#article_editor</small></h2>

		<!--Dev Test Editor Toolbar-->
		<style>
			#dev_test_editor_toolbar {padding: .5rem 1.5rem;}
			#dev_test_editor_toolbar > h4 {display: inline-block; margin-right: .5rem; color: darkgray;}
			#dev_test_editor_toolbar > label {margin: 0 0 0 .5rem;}
			#dev_test_editor_toolbar > input[type="checkbox"] {margin: 0; vertical-align: middle;}
			#dev_test_editor_toolbar > input[type="button"] {margin-left: 1rem;}
		</style>
		<div id="dev_test_editor_toolbar" class="panel">
			<h4 class="text-medium">Show</h4>
			<label for="show_publishing">Publishing</label>
			<input id="show_publishing" type="checkbox" name="show" value="publishing" checked>
			<label for="show_classic_editor">Classic Editor</label>
			<input id="show_classic_editor" type="checkbox" name="show" value="classic_editor_fieldset">
			<label for="show_inline_editor">Inline Editor</label>
			<input id="show_inline_editor" type="checkbox" name="show" value="inline_editor_fieldset">
			<label for="show_rubrics_switcher">Rubrics Switcher</label>
			<input id="show_rubrics_switcher" type="checkbox" name="show" value="rubrics_switcher">
			<input id="cke_plugins" class="button tiny" type="button" value="CKEditor plugins">
		</div>
		<script>
		// Events
		$("html").on("click", "[name='show']", function() {
			var f = $(this).val();
			$("#" + f).toggle();
		});
		$("html").on("click", "#cke_plugins", function() {
			var cke_plugins = CKEDITOR.config.plugins.split(",");
			var str = new String;
			for (i in cke_plugins) {
				str += cke_plugins[i] + "\n";
			}
			alert(str);
		});
		// Init
		$(document).ready(function() {
			$("[name='show']").each(function() {
				var f = $(this).val();
				if ($(this).is(":checked")) {
					$("#" + f).show();
				} else {
					$("#" + f).hide();
				}
			});
		});
		</script>

		<form class="article edit" method="get" accept-charset="utf-8" autocomplete="off" novalidate>

			<fieldset id="publishing" class="transparent">
				<legend class="hide">Publication</legend>

				<!--Title-->
				<label for="title" class="hide">Titre de l&rsquo;article</label>
				<input id="title" class="title" type="text" placeholder="Le titre de l&rsquo;article">
				<small class="error hide">Ce titre est d&eacute;j&agrave; pris</small>

				<!--Author-->
				<!--
				<label for="author">R&eacute;dactrice</label>
				<input id="author" type="text" disabled>
				-->
				<h4 class="author"><span class="icon-author" title="Auteure"><span class="text">Nadejda</span></span></h4>

				<!--Date-->
				<!--
				<time datetime="2014-01-01" class="date icon-date small">1<sup>er</sup> janvier 2014</span>
				-->

				<!--Status-->
				<!--
				<label for="status">Statut</label>
				<select id="status" disabled>
					<option selected>Brouillon</option>
					<option>En attente de validation</option>
					<option>En ligne</option>
				</select>
				-->

				<!--Summary-->
				<label for="summary" class="hide">R&eacute;sum&eacute; <small class="red">*</small></label>
				<textarea id="summary" class="summary validation min" maxlength="1000" placeholder="Une br&egrave;ve description de l&rsquo;article pour le r&eacute;f&eacute;rencement (1000 caract&egrave;res maximum)"></textarea>
				<small class="error hide">La saisie du r&eacute;sum&eacute; est obligatoire</small>

				<!--Tags List-->
				<dl class="tags inline-list clearfix" tabindex="0">
					<dt class="icon-tag small"><strong class="text hide">Tags</strong></dt>
					<!--
					<dd><a href="javascript:void(0)" rel="tag" class="label radius">Rubrique</a></dd>
					<dd><a href="javascript:void(0)" rel="tag" class="label radius inverse">Cat&eacute;gorie</a></dd>
					-->
				</dl>
				<script>

					// Display indexation panel (i.e. tags editing)
					function toggle_tags() {
						$(".tags").blur();
						if ($(".tags").data("preventClick") !== "true" && $(".tags").data("preventToggle") !== "true") {
							$(".tags").toggleClass("active");
							if ($("#indexing").is(":visible")) {
								$("#indexing").slideUp();
							} else {
								$(".tags").data("preventToggle", "true");
								$("#indexing").slideDown();
								setTimeout(function() {
									scrollTo($("#indexing"), 250, $("#indexing").height() + 16); // scroll to indexing box including tags
									$(".tags").removeData("preventToggle");
									$("#rubric").focus();
								}, 500);
							}
						}
					}

					// Tags list prevent click from child element
					$(".tags dd").on("mouseenter", function() {
						$(".tags").data("preventClick", "true");
					});
					$(".tags dd").on("mouseleave", function() {
						$(".tags").removeData("preventClick");
					});

					// Tags list toggle indexation display
					$(".tags").on("click", function() {
						toggle_tags();
					});
					$(".tags").on("keypress", function(e) {
						if (e.which === 13) {
							toggle_tags();
						}
					});

				</script>

			</fieldset>

			<fieldset id="indexing" style="display: none;">
				<legend>Ind&eacute;xation</legend>

				<!--Rubric-->
				<!--
				<div class="row collapse">
					<div class="column small-12">
						<label for="rubric">Rubrique <small class="red">*</small></label>
							<select id="rubric">
								<option disabled selected>&hellip;</option>
								<option class="test" data-color="orange">Luttes</option>
								<option data-color="magenta">Nos corps, nous-m&ecirc;mes</option>
								<option data-color="red">Intersectionnalit&eacute;</option>
								<option data-color="blue">International</option>
								<option data-color="cyan">&Eacute;ducation & Culture</option>
								<option data-color="yellow">Id&eacute;es</option>
							</select>
					</div>
				</div>
				-->
				<label for="rubric">Rubrique <small class="red">*</small></label>
				<div id="rubric" class="options-select validation" tabindex="0">
					<span class="select"><span class="text-silver">Veuillez indiquer la rubrique de l&rsquo;article</span></span>
					<ul class="options hide">
						<li><span class="icon-struggles small" style="margin-right: .25rem;"></span>Luttes</li>
						<li><span class="icon-ourbody small" style="margin-right: .25rem;"></span>Nos corps, nous-m&ecirc;mes</li>
						<li><span class="icon-intersec small" style="margin-right: .25rem;"></span>Intersectionnalit&eacute;</li>
						<li><span class="icon-internat small" style="margin-right: .25rem;"></span>International</li>
						<li><span class="icon-educult small" style="margin-right: .25rem;"></span>&Eacute;ducation & Culture</li>
						<li><span class="icon-ideas small" style="margin-right: .25rem;"></span>Id&eacute;es</li>
					</ul>
				</div>
				<small class="error hide">La saisie de la rubrique est obligatoire</small>

				<!--Category-->
				<!--
				<div class="row collapse">
					<div class="column small-12">
						<label for="category">Cat&eacute;gorie <small class="red">*</small></label>
						<select id="category">
							<option disabled selected>&hellip;</option>
							<option>Br&egrave;ve</option>
							<option>Reportage</option>
							<option>Dossier</option>
							<option>Spotlight</option>
							<option>Interview</option>
							<option>Tribune</option>
							<option>Revue du web</option>
						</select>
					</div>
				</div>
				-->
				<label for="category">Cat&eacute;gorie <small class="red">*</small></label>
				<div id="category" class="options-select validation" tabindex="0">
					<span class="select"><span class="text-silver">Veuillez choisir une une cat&eacute;gorie d&rsquo;article</span></span>
					<ul class="options hide">
						<li>Br&egrave;ve</li>
						<li>Reportage</li>
						<li>Dossier</li>
						<li>Spotlight</li>
						<li>Interview</li>
						<li>Tribune</li>
						<li>Revue du web</li>
					</ul>
				</div>
				<small class="error hide">La saisie de la cat&eacute;gorie est obligatoire</small>

				<!--Tags-->
				<label for="tag">Tags</label>
				<style>
					/* Named Components */
					#tag {}
					#tag_add {margin-bottom: 0;}
					/* Autocomplete */
					.autocomplete {
						font-size: 87.5%;
						background-color: rgba(255, 0, 0, .5);
						background-color: transparent;
						transition: box-shadow .5s;
					}
					.autocomplete ul {
						margin: 0 0 1rem;
						list-style: none;
						background-color: rgba(0, 255, 0, .5);
						background-color: white;
						border-width: 0 .125rem;
						border-style: solid;
						border-color: silver;
					}
					.autocomplete ul > li {
						padding: 0 .5rem;
						line-height: 200%;
					}
					.autocomplete ul > li.selected {
						color: HighlightText;
						background-color: Highlight;
						font-weight: bold;
					}
					.autocomplete ul > li.selected mark {
						color: white;
						background-color: #d52;
					}
					.autocomplete ul > li.suggested-fetch {
						font-weight: bold;
					}
					.autocomplete ul > li.suggested-fetch:after {
						content: "Suggéré";
						float: right;
						color: darkgray;
						font-size: 75%;
						font-weight: bold;
					}
					.autocomplete ul > li.suggested-fetch.selected:after {
						color: rgba(255, 255, 255, .5);
					}
					input:focus + button + .error + .autocomplete {
						-webkit-box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .5);
							 -moz-box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .5);
										box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .5);
					}
					input:focus + button + .error + .autocomplete > ul {
						border-color: darkgray;
					}
					.css-debug .autocomplete ul > li:nth-child(odd) {
						background-color: rgba(0, 255, 0, .5);
					}
					.css-debug .autocomplete ul > li:nth-child(even) {
						background-color: rgba(0, 0, 255, .5);
					}
				</style>
				<div>
					<input id="tag" class="validation" style="display: inline-block; height: 2.25rem; width: 16rem; border-width: .125rem;" type="text" placeholder="Une &eacute;tiquette au choix (32 carac.)" maxlength="32"><button id="tag_add" type="button" href="javascript:void(0)" class=" icon-add small" style=""></button>
					<small id="tag_error" class="hide error" style="top: 0; width: 16rem;">Ce tag est déjà pris !</small>
					<div class="autocomplete hide" style="position: relative; width: 16rem; z-index: 2;">
						<ul>
							<li>Amphibien</li>
							<li>Amphipode</li>
							<li>Amphithéatre</li>
							<li>Amphore</li>
							<li>Amphotère</li>
							<li>Amplificateur</li>
							<li>Ampoule</li>
							<li>Amputation</li>
							<li>Jeu ViDeo</li>
							<li>Jeux-vidéos</li>
							<li>Jeux  vidéos</li>
							<li class="suggested-fetch" >Jeux vidéos</li>
							<li>JEUX VIDEOS</li>
							<li>Jeux_vidéos</li>
						</ul>
					</div>
				</div>
				<div style="margin-bottom: 1rem;"><span style="font-size: 87.5%; color: dimgray;">Try it now ! Type <code>amp</code> or <code>jeu</code> in the input.</span></div>

				<script>
					// vars
					var min_i = 3;
					var max_displayed_items = 6;
					var i = min_i;
					var white_spaces_replacement = " "; // white spaces replacement
					var accepted_chars_list = /[^\w\d\s\+\-\=\%\&\€\?\!\'\’\éêèëàâäùûüîïôœ]+/i; // accepted chars list
					// methods
					function check_illegal_chars(str, reg) {
						var reg = reg || accepted_chars_list;
						if (reg.test(str)) {
							return true;
						} else {
							return false;
						}
					}
					function check_error(selector, error_margin) {
						var error_margin = error_margin || "";
						if (check_illegal_chars($(selector).val()) == true) {
							$(selector).css("margin-bottom", "0");
							$(selector).nextAll("small.error").first().css("margin-bottom", error_margin);
							$(selector).set_validation(false, "Caract&egrave;re(s) invalide(s)&thinsp;!");
						} else if ($(selector).val().length === 0) {
							$(selector).set_validation(true);
							$(selector).removeClass("valid");
						} else {
							$(selector).set_validation(true);
						}
					}
					// events
					$("#tag").bind({
						focus : function() {
							$(this).css("margin-bottom", "0");
							$(".autocomplete").removeClass("hide");
							check_error(this, "0"); // check error
						},
						blur : function() {
							$(this).val($(this).val().trim()); // remove white spaces
							$(this).val($(this).val().replace(/\s+/g, white_spaces_replacement)); // replace white spaces
							$(".autocomplete").addClass("hide");
							$("#tag").css("margin-bottom", "");
							check_error(this); // check error
						},
						keydown : function(e) {
							if (e.which == 13 || e.which == 27) { // Enter or Escape
								$(this).blur();
							}
							if (e.which == 33 || e.which == 34 || e.which == 38 || e.which == 40) { // PageUp, PageDown, End, Home or Up or Down
								e.preventDefault();
								index = 0;
								var index = $(".autocomplete ul > li.selected").index();
								if (index == -1) {
									$(".autocomplete ul > li").not(".hide").first().addClass("selected");
								}
								if (e.which == 33) { // PageUp
									$(".autocomplete ul > li").removeClass("selected");
									$(".autocomplete ul > li").not(".hide").first().addClass("selected");
								}
								if (e.which == 34) { // PageDown
									$(".autocomplete ul > li").removeClass("selected");
									$(".autocomplete ul > li").not(".hide").last().addClass("selected");
								}
								if (e.which == 38 && index - 1 >= 0) { // Up
									$(".autocomplete ul > li:eq(" + index + ")").prevAll("li:not('.hide')").first().addClass("selected");
									if ($(".autocomplete ul > li:eq(" + index + ")").prevAll("li:not('.hide')").first().hasClass("selected")) {
										$(".autocomplete ul > li:eq(" + index + ")").removeClass("selected");
									}
								}
								if (e.which == 40) { // Down
									$(".autocomplete ul > li:eq(" + index + ")").nextAll("li:not('.hide')").first().addClass("selected");
									if ($(".autocomplete ul > li:eq(" + index + ")").nextAll("li:not('.hide')").first().hasClass("selected")) {
										$(".autocomplete ul > li:eq(" + index + ")").removeClass("selected");
									}
								}
								var s = $(".autocomplete ul > li.selected").text();
								$(this).val(s);
								// scroll to selected item
								if ($(".autocomplete ul > li").hasClass("selected")) {
									if ($(".autocomplete ul > li").not(".hide").first().hasClass("selected")) {
										scrollTo($("#tag"), 250, $("#tag").outerHeight());
									} else if ($(".autocomplete ul > li").not(".hide").last().hasClass("selected")) {
										scrollTo($(".autocomplete ul > li.selected"), 250, $("#tag").outerHeight());
									} else {
										scrollTo($(".autocomplete ul > li.selected"), 0);
									}
								}
							}
						},
						keyup : function(e) {
							check_error(this, "0"); // check error
							if ((e.which >= 48 && e.which <= 57) || (e.which >= 64 && e.which <= 90) || (e.which >= 96 && e.which <= 105) || e.which == 32 || e.which == 8 || e.which == 46) { // From 0 to 9 or from A to Z or from Numpad 0 to Numpad 9 or Space or Backspace or Del
								$(".autocomplete ul > li").removeClass("selected"); // unselect all
								if (e.which == 8 || e.which == 46) { // Backspace or Del
									if (i > 0) {
										i -= 1;
									}
								}
								if ($(this).val().length >= min_i) {
									var k = 0;
									var m = $(this).val();
									i = $(this).val().length;
									$(".autocomplete ul > li").each(function() {
										var r = $(this).text().slice(0, i);
										if (r.toLowerCase() == m.toLowerCase() && k < max_displayed_items) {
											var str = $(this).text();
											var html = "<mark>" + str.slice(0, i) + "</mark>" + str.substr(i, str.length);
											$(this).html(html);
											$(this).removeClass("hide");
											k++;
										} else {
											$(this).addClass("hide");
										}
									});
									// scroll
									if ($(".autocomplete").offset().top + $(".autocomplete").height() > $(window).height() + $(document).scrollTop()) {
										scrollTo($(".autocomplete ul > li:visible").last(), 500, $("#tag").outerHeight());
									} else {
										scrollTo($(".autocomplete").parent(), 500, $("#tag").outerHeight());
									}
								} else {
									$(".autocomplete ul > li").each(function() {
										$(this).addClass("hide"); // hide all autocompletion items
									});
								}
							}
						},
					});
					$(".autocomplete ul > li").not("hide").bind({
						mouseenter : function() {
							$(this).siblings().removeClass("selected");
							$(this).addClass("selected");
							$("#tag").val($(this).text());
							check_error("#tag", "0"); // check error
						},
						mouseleave : function() {
							$(this).removeClass("selected");
						}
					});
					$(document).ready(function() {
						$(".autocomplete ul > li").each(function() {
							$(this).addClass("hide"); // hide all autocompletion items
						});
					});
				</script>

			</fieldset>

			<!--Rubrics Switcher-->
			<style>
				#rubrics_switcher {text-align: center;}
				#rubrics_switcher > ul,
				#rubrics_switcher > ul > li,
				#rubrics_switcher > ul > li > a {margin-bottom: 0;}
			</style>
			<div id="rubrics_switcher">
				<ul class="inline-list">
					<li><a id="cke_rub_intersec" href="javascript:void(0)" class="button small secondary">Intersectionnalit&eacute;</a></li>
					<li><a id="cke_rub_struggles" href="javascript:void(0)" class="button small secondary">Luttes</a></li>
					<li><a id="cke_rub_ideas" href="javascript:void(0)" class="button small secondary">Id&eacute;es</a></li>
					<li><a id="cke_rub_educult" href="javascript:void(0)" class="button small secondary">&Eacute;ducation &amp; Culture</a></li>
					<li><a id="cke_rub_internat" href="javascript:void(0)" class="button small secondary">International</a></li>
					<li><a id="cke_rub_ourbody" href="javascript:void(0)" class="button small secondary">Nos corps, nous-m&ecirc;mes</a></li>
				</ul>
			</div>
			<script>
				$("[id^='cke_rub_']").click(function() {
					$(this).parent().siblings().children().removeClass("active"); // Remove all active classes for rubrics buttons
					$("#inline_editor").removeClass(); // Remove all classes for inline editor
					$("#inline_editor").addClass("article"); // Reset article class for inline editor
					if ($(this).hasClass("active")) {
						$(this).removeClass("active");
					} else {
						$(this).addClass("active");
						var cls = $(this).attr("id").substr(8); // Retrieve rubric class from button id
						$("#inline_editor").addClass(cls); // Add new rubric class to inline editor
					}
					CKEDITOR.instances["classic_editor"].destroy(); // Destroy classic editor instance
					CKEDITOR.replace("classic_editor", { // Reinitialize classic editor instance with rubric class
						customConfig : $cke_config_path + "editor_settings.js",
						contentsCss : "css/loap-main.css",
						bodyClass : "article " + cls,
						toolbarLocation : "bottom"
					});
				});
			</script>

			<!--Classic CKEditor-->
			<fieldset id="classic_editor_fieldset">
				<legend>R&eacute;daction</legend>
				<label for="classic_editor">Corps de texte <span class="text-silver">classic</span></label>
				<textarea id="classic_editor">
					<h4>Un inter&dash;titre tout &agrave; fait ordinaire</h4>
					<div class="callout">Une accroche qui reprend le texte en-dessous pour attirer l&rsquo;attention du lectorat</div>
					<p>Un paragraphe plut&ocirc;t court avec un <a href="#">lien hypertexte</a> &agrave; l&rsquo;int&eacute;rieur.</p>
					<p><img alt="Ours" src="http://www.cinephilme.com/public/ours/l-ours-332883.jpg" style="height: 200px; margin: 10px;" />Un paragraphe avec une image &agrave; l&rsquo;int&eacute;rieur.</p>
				</textarea>
			</fieldset>

			<!--Inline CKEditor-->
			<fieldset id="inline_editor_fieldset" class="transparent">
				<legend class="hide">R&eacute;daction</legend>
				<label for="inline_editor" class="hide">Corps de texte <span class="text-silver">inline</span></label>
				<div id="inline_editor" class="inline-editor" contenteditable="true">
					<h4>Un inter&dash;titre tout &agrave; fait ordinaire</h4>
					<div class="callout">Une accroche qui reprend le texte en-dessous pour attirer l&rsquo;attention du lectorat</div>
					<p>Un paragraphe plut&ocirc;t court avec un <a href="#">lien hypertexte</a> &agrave; l&rsquo;int&eacute;rieur.</p>
					<p><img alt="Ours" src="http://www.cinephilme.com/public/ours/l-ours-332883.jpg" style="height: 200px; margin: 10px;" />Un paragraphe avec une image &agrave; l&rsquo;int&eacute;rieur.</p>
				</div>
			</fieldset>

			<!--Validation Buttons-->
			<div class="text-center" style="margin-top: 1rem;">
				<input class="button secondary tip-top" type="button" value="Lecture seule" title="Visualiser l&rsquo;article sans les fonctionnalit&eacute;s d&rsquo;&eacute;dition" data-tooltip data-options="disable_for_touch:true">
				<input class="button success tip-top" type="button" value="Enregistrer" title="Mettre l&rsquo;article de c&ocirc;t&eacute; pour le modifier plus tard" data-tooltip data-options="disable_for_touch:true">
				<input class="button alert tip-top" type="button" value="Valider" title="Soumettre l&rsquo;article &agrave; la r&eacute;daction pour publication" data-tooltip data-options="disable_for_touch:true">
			</div>

		</form>

		<script>
			$build_container = false;
			load();
		</script>
		<script>
			loap.update()
			$(document).ready(function(){
				$("textarea").autosize({append: ""}); // Apply autosize plugin to all <textarea> of the page
				$("textarea").add_confirmation_bar(); // Apply add_confirmation_bar plugin to all <textarea> of the page
				$(".options-select").options_select(); // Apply options_select plugin to all .options-select of the page
			});
		</script>
		<script>
			// Initialize Foundation plugins
			$(document).foundation();
			// Initialize classic CKEditor with custom config
			CKEDITOR.replace("classic_editor", {
				customConfig : $cke_config_path + "editor_settings.js",
				contentsCss : "css/loap-main.css",
				bodyClass : "article",
				toolbarLocation : "bottom"
			});
			// Initialize inline CKEditor with custom config
			CKEDITOR.disableAutoInline = true;
			CKEDITOR.inline("inline_editor", {
				customConfig : $cke_config_path + "editor_settings.js",
				contentsCss : "css/loap-main.css"
			});
		</script>
	</body>
</html>
